<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="script" href="js/flv.min.js" />
    <link rel="script" href="js/jquery-3.4.1.min.js" />
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/index-body.css">
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="header">
        <img id="logo" class="header-left" src="img/logo.jpg" alt="ez4webcast" />

        <ul class="header-menu">
            <li class="header-menu-link header-left"><a href="index.html">首页</a></li>
            <li class="header-menu-link header-left"><a href="index.html">直播</a></li>
            <li class="header-menu-link header-left"><a href="bbslist.html">贴吧</a></li>
            <li class="header-menu-link header-left"><a href="index.html">反馈</a></li>
        </ul>


        <div id="loginBtn" class="header-right login-register-button" >
            <a href="login.html">登录</a>
            <span style="color: white"> / </span>
            <a href="register.html">注册</a>
        </div>

        <div>
            <img id="headImg" style="display:none; margin-top:-10px;margin-right: 10%;border-radius:50%;float: right;height: 50px;" src="#">
        </div>

        <div class="header-right header-right-menu-items">
            <a href="#">
                <embed style="width: 40px" src="img/care.svg" type="image/svg+xml"/>
                <p>关注</p>
            </a>
        </div>

        <div class="header-right header-right-menu-items">
            <a href="#">
                <embed style="width: 40px" src="img/camera.svg" type="image/svg+xml"/>
                <p>开播</p>
            </a>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            //alert("aaa");
            var token = sessionStorage.getItem('token');
            //alert(token);
            console.log(token);
            var xmlHttp = createXMLHttpRequest();

            xmlHttp.open("POST",'http://fs2.lzfnb.top/api/user/context', true);
            xmlHttp.onreadystatechange = handler;
            xmlHttp.withCredentialstrue = true;
            xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin','*');
            xmlHttp.setRequestHeader('Access-Control-Allow-Method','POST,GET');
            xmlHttp.setRequestHeader('Platform-Token',token);

            xmlHttp.send(null);

            function handler() {

                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {

                    var responseText = xmlHttp.responseText;
                    var info = JSON.parse(responseText);

                    if(info.code == 1){
                        var msg="请先登录！";
                        alert(msg);
                        window.location.href = 'login.html';

                    }else if(info.code == 0){//成功

                        var username = info.data.nickName;
                        var headImg = info.data.headImage;

                        if(headImg == null){
                            $("#headImg").attr("src", "https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2133261431,2800577620&fm=26&gp=0.jpg");
                            $("#loginBtn").css("display",'none');
                            $("#headImg").css("display",'');
                        }else{
                            $("#headImg").attr("src",headImg);
                            $("#loginBtn").css("display",'none');
                            $("#headImg").css("display",'');
                        }

                        console.log(username);

                    }
                }
            }

        });

        function createXMLHttpRequest() {
            return new XMLHttpRequest()
        }
    </script>


</body>
</html>