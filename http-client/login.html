<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/header.css">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta http-equiv="Access-Control-Expose-Headers" content="*">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div class="modal-dialog" style="margin-top: 10%;">
    <div class="modal-content">
        <div class="modal-header">

            <h4 class="modal-title text-center" id="myModalLabel">登录</h4>
        </div>
        <div class="modal-body" id = "model-body">
            <div class="form-group">
                <input type="text" class="form-control" placeholder="邮箱" autocomplete="off" id="email">
            </div>
            <div class="form-group">

                <input type="password" class="form-control" placeholder="密码" autocomplete="off" id="password">
            </div>
            <span id="msg" style="color: red"></span>
        </div>
        <div class="modal-footer">

            <div class="form-group">
                <button type="button" class="btn btn-primary form-control" style="width:320px;float: left" id="btn">登录</button>
            </div>

            <div class="form-group">
                <button type="button" class="btn btn-default form-control" style="width:200px;margin-top:-14px;">注册</button>
            </div>

        </div>
    </div>
</div>


<script type="text/javascript">


    window.onload = function () {

        var btn = document.getElementById("btn");

        btn.onclick = function () {

            var username = document.getElementById("email").value;
            var password = document.getElementById("password").value;

            console.log("aaa"+username+password);

            var xmlHttp = createXMLHttpRequest();

            xmlHttp.open("POST",'http://fs2.lzfnb.top/api/user/login', true);
            xmlHttp.onreadystatechange = handler;
            xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xmlHttp.setRequestHeader('Access-Control-Allow-Origin','*');
            xmlHttp.setRequestHeader('Access-Control-Allow-Headers','Origin, X-Requested-With, Content-Type, Accept, Connection, User-Agent, Cookie, token');
            xmlHttp.setRequestHeader('Access-Control-Allow-Method','POST,GET');
            var data = 'username=' + username  + '&password=' + password;

            xmlHttp.send(data);

            function handler() {

                if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {

                    var responseText = xmlHttp.responseText;
                    var info = JSON.parse(responseText);

                    if(info.code == 1){
                        var msg="用户名或密码错误";
                        document.getElementById("msg").innerText=msg;

                    }else{//成功
                        //保存token数据到session

                        var cookie = xmlHttp.getResponseHeader("Platform-Token");
                        var aa = xmlHttp.getAllResponseHeaders();
                        console.log(cookie);
                        sessionStorage.setItem('token',cookie);

                        url = "index.html";
                        window.location.href = url;
                    }
                }
            }

        }
    };

    function createXMLHttpRequest() {
        return new XMLHttpRequest()
    }
</script>

</head>

</body>
</html>