<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="css/detail.css">
    <script src="js/jquery-3.4.1.min.js" ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.12/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<script>
    $(document).ready(function() {
        var token = sessionStorage.getItem('token');
        var vm = new Vue({
            el: '#detail',
            data:{
                allInfo:null,
                floorInfo:null,
                img:"",
            },

            created: function () {
                console.log("created");
                this.fetchData();

            },
            methods: {
                fetchData() {
                    axios.get('http://fs2.lzfnb.top/api/bbs/view/post', {
                        params: {
                            post: 2,
                        },
                        headers: {
                            "Accept": "application/json; charset=utf-8",
                            "Content-Type": "application/javascript; charset=utf-8",
                            "Access-Control-Allow-Origin": "*",
                            'Platform-Token': token,
                        },
                        dataType: 'json',
                    }).then(response => {
                        this.floorInfo = response.data.data.floors;
                        this.allInfo = response.data.data;
                        this.loadImg(this.allInfo.id);
                        // console.log(this.allInfo.title);
                        // console.log(this.floorInfo.length);

                    }).catch(error => {
                        console.log("error" + error);
                        console.log("failure")
                    })
                },
                loadImg(id){
                    axios.get('http://fs2.lzfnb.top/api/image/load', {
                        params: {
                            id: id,
                        },
                        headers: {
                            "Accept": "application/json; charset=utf-8",
                            "Content-Type": "application/binary;",
                            "Access-Control-Allow-Origin": "*",
                            'Platform-Token': token,
                        },
                        dataType: 'json',
                    }).then(response => {
                        this.img = response.data;
                        // console.log(this.img);

                    }).catch(error => {
                        console.log("error" + error);
                        console.log("failure")
                    })
                }
            }

        });
    })
</script>

<body>
<script>
    $(function(){
        $(".headerpage").load('header.html');
    });
</script>

<div id="detail">
    <div>
        <div class="headerpage"></div>
    </div>
    <div class="bblistBody">
        <div class="bblistBody1">

            <div class="bblistBody1List">
            <span class="bblistBodyTital" style="display: inline-block;">
                    {{allInfo.title}}
            </span>
            </div>

            <div class="detailComment" v-for="temp in floorInfo">

                <div class="detailUser">
<!--                    <img class="detailUserImg" src="https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/tb.1.a1566bad.-lkenZZFvOdu2CXsncy28w?t=1454557820">-->
                    <img class="detailUserImg" src="data:image/jpg;base64,{{img}}">

                    <div class="detailUserName">{{temp.createUser.nickName}}</div>

                </div>

                <div class="detailContent">
                    {{temp.content}}
                </div>

            </div>

        </div>
    </div>
</div>
</body>
</html>